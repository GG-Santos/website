// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider      = "prisma-client-js"
  output        = "../generated/client"
  binaryTargets = ["native", "rhel-openssl-3.0.x"]
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id            String        @id @map("_id")
  name          String
  email         String
  emailVerified Boolean       @default(false)
  image         String?
  bio           String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @default(now()) @updatedAt
  sessions      Session[]
  accounts      Account[]
  blogPosts     BlogPost[]
  roadmapItems  RoadmapItem[]

  @@unique([email])
  @@map("user")
}

model Session {
  id        String   @id @map("_id")
  expiresAt DateTime
  token     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  ipAddress String?
  userAgent String?
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([token])
  @@map("session")
}

model Account {
  id                    String    @id @map("_id")
  accountId             String
  providerId            String
  userId                String
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  @@map("account")
}

model Verification {
  id         String   @id @map("_id")
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @default(now()) @updatedAt

  @@map("verification")
}

model BlogPost {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  title      String
  slug       String   @unique
  excerpt    String
  content    String
  image      String
  published  Boolean  @default(false)
  authorId   String
  author     User     @relation(fields: [authorId], references: [id], onDelete: Cascade)
  categories String[]
  tags       String[]
  views      Int      @default(0)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @default(now()) @updatedAt

  @@index([published])
  @@index([createdAt])
  @@map("blogpost")
}

model RoadmapItem {
  id             String   @id @default(auto()) @map("_id") @db.ObjectId
  title          String
  slug           String   @unique
  excerpt        String
  content        String
  featuredImage  String
  gallery        String[] // Array of image URLs
  youtubeVideoId String? // YouTube video ID for embedding
  displayDate    DateTime? // Optional display date for roadmap (user can set custom date)
  published      Boolean  @default(false)
  authorId       String
  author         User     @relation(fields: [authorId], references: [id], onDelete: Cascade)
  categories     String[]
  tags           String[]
  views          Int      @default(0)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @default(now()) @updatedAt

  @@index([published])
  @@index([createdAt])
  @@index([displayDate])
  @@map("roadmapitem")
}

model GameAsset {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  title       String
  image       String   // Vercel Blob URL
  description String?  // Character description (limited to 100 words)
  blogLink    String?  // Link for the blog button
  difficulty  Int      @default(1) // 1 to 5
  pinned      Boolean  @default(false) // Pinned items shown on homepage
  category    String   // e.g., "Character"
  type        String?  // Optional type field
  published   Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @default(now()) @updatedAt

  @@index([pinned])
  @@index([published])
  @@index([createdAt])
  @@map("gameasset")
}

model GameObjective {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  category   String
  title      String
  image      String   // Image URL
  published  Boolean  @default(true)
  order      Int      @default(0) // For custom ordering
  createdAt  DateTime @default(now())
  updatedAt  DateTime @default(now()) @updatedAt

  @@index([published])
  @@index([order])
  @@index([createdAt])
  @@map("gameobjective")
}

model Testimonial {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  quote       String
  name        String
  designation String
  image       String   // Image URL
  order       Int      @default(0) // For custom ordering (max 8 testimonials)
  published   Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @default(now()) @updatedAt

  @@index([published])
  @@index([order])
  @@index([createdAt])
  @@map("testimonial")
}

model SiteSettings {
  id                  String    @id @map("_id")
  heroBackgroundImage String    @default("")
  header              Json      // { siteName: string, menuItems: Array<{label, href}> }
  pages               Json      // Record<PageKey, { title, subtitle }>
  footer              Json      // { text: string, links: Array<{label, href}> }
  homeSections        Json      // { about, features, collection, investors, blog }
  aboutHomeSection    Json?     // { title: string, description: string, image: string }
  aboutPage           Json?     // { image: string, team: Array<{name, title, imageUrl, socialLinks?}> }
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @default(now()) @updatedAt

  @@map("siteSettings")
}

model Investor {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  name      String?  // Optional investor name
  logo      String   // Vercel Blob URL
  url       String?  // Optional link URL
  order     Int      @default(0) // For custom ordering
  published Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt

  @@index([published])
  @@index([order])
  @@index([createdAt])
  @@map("investor")
}

// c15t consent management models
// Note: c15t generates its own string IDs (e.g., "sub_..."), not ObjectIDs
model subject {
  id String @id @map("_id")
  isIdentified Boolean
  externalId String?
  identityProvider String?
  lastIpAddress String?
  subjectTimezone String?
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
  consents consent[] @relation("consent_subject")
  consentRecords consentRecord[] @relation("consentRecord_subject")
  auditLogs auditLog[] @relation("auditLog_subject")
}

model domain {
  id String @id @map("_id")
  name String @unique
  description String?
  allowedOrigins Json?
  isVerified Boolean
  isActive Boolean
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
  consents consent[] @relation("consent_domain")
}

model consentPolicy {
  id String @id @map("_id")
  version String
  type String
  name String
  effectiveDate DateTime
  expirationDate DateTime?
  content String
  contentHash String
  isActive Boolean
  createdAt DateTime @default(now())
  consents consent[] @relation("consent_consentPolicy")
}

model consentPurpose {
  id String @id @map("_id")
  code String
  name String
  description String
  isEssential Boolean
  dataCategory String?
  legalBasis String?
  isActive Boolean
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
}

model consent {
  id String @id @map("_id")
  subjectId String
  domainId String
  policyId String?
  purposeIds Json
  metadata Json?
  ipAddress String?
  userAgent String?
  status String
  withdrawalReason String?
  givenAt DateTime @default(now())
  validUntil DateTime?
  isActive Boolean
  subject subject @relation("consent_subject", fields: [subjectId], references: [id], onDelete: Cascade)
  domain domain @relation("consent_domain", fields: [domainId], references: [id], onDelete: Cascade)
  policy consentPolicy? @relation("consent_consentPolicy", fields: [policyId], references: [id], onDelete: Cascade)
  consentRecords consentRecord[] @relation("consentRecord_consent")
}

model auditLog {
  id String @id @map("_id")
  entityType String
  entityId String
  actionType String
  subjectId String?
  ipAddress String?
  userAgent String?
  changes Json?
  metadata Json?
  createdAt DateTime @default(now())
  eventTimezone String
  subject subject? @relation("auditLog_subject", fields: [subjectId], references: [id], onDelete: Cascade)
}

model consentRecord {
  id String @id @map("_id")
  subjectId String
  consentId String?
  actionType String
  details Json?
  createdAt DateTime @default(now())
  subject subject @relation("consentRecord_subject", fields: [subjectId], references: [id], onDelete: Cascade)
  consent consent? @relation("consentRecord_consent", fields: [consentId], references: [id], onDelete: Cascade)
}

model private_c15t_settings {
  key String @id @map("_id")
  value String @default("1.0.0")
}
